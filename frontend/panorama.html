<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panorama Mensal Resumido - Superendividamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: url('SuperEndBackgroundTransparente.png') no-repeat center center fixed;
            background-size: cover;
        }
        .container { max-width: 1100px; margin: 30px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
        .titulo-topo { font-size: 1.1em; font-weight: bold; text-align: center; }
        .panorama-title { color: #0074d9; font-weight: bold; font-size: 1.3em; text-align: center; margin: 20px 0 30px 0; }
        .retangulo { border: 2px solid #bbb; border-radius: 10px; margin-bottom: 18px; background: #f8f9fa; padding: 18px 18px 10px 18px; position: relative; }
        .retangulo-verde { background: #e6f9e6; border: 2px solid #7ed87e; }
        .retangulo-icone { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 2.5em; float: left; margin-right: 18px; }
        .retangulo-titulo { font-weight: bold; font-size: 1.1em; margin-bottom: 6px; }
        .retangulo-valor { font-size: 2em; font-weight: bold; color: #007a00; }
        .retangulo-valor-neg { color: #d00; }
        .retangulo-valor-pct { font-size: 1.2em; font-weight: bold; color: #0074d9; }
        .retangulo-label { font-size: 1em; color: #333; }
        .retangulo-autos { position: absolute; right: 18px; top: 18px; background: #c6f5c6; border: 2px solid #7ed87e; border-radius: 6px; padding: 8px 18px; font-size: 1.1em; font-weight: bold; }
        .retangulo-obs { font-size: 0.95em; color: #444; margin-top: 10px; }
        .retangulo-icone-alarme { color: #ff9800; }
        .retangulo-icone-dinheiro { color: #007a00; }
        .retangulo-icone-folha { color: #0074d9; }
        .retangulo-icone-cartao { color: #d00; }
        .retangulo-icone-comprometido { color: #e91e63; }
        .retangulo-icone-outros { color: #9c27b0; }
        .retangulo-icone-emergencial { color: #ff9800; }
        .retangulo-pct-limite { color: #2e7d32; font-size: 1.5em; font-weight: bold; }
        .retangulo-valor-livre { color: #007a00; font-size: 1.3em; font-weight: bold; }
        .retangulo-valor-neg { color: #d00; }
        .retangulo-valor-porcento { font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-neg { color: #d00; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-verde { color: #2e7d32; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-alarme { color: #ff9800; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-azul { color: #0074d9; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-cinza { color: #888; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-preto { color: #000; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-roxo { color: #9c27b0; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-rosa { color: #e91e63; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-vermelho { color: #d00; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-laranja { color: #ff9800; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-amarelo { color: #ffc107; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-azul-claro { color: #03a9f4; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-verde-claro { color: #8bc34a; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-cinza-claro { color: #bdbdbd; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-preto-claro { color: #333; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-roxo-claro { color: #ce93d8; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-rosa-claro { color: #f8bbd0; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-vermelho-claro { color: #ffcdd2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-laranja-claro { color: #ffe0b2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-amarelo-claro { color: #fff9c4; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-azul-claro2 { color: #b3e5fc; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-verde-claro2 { color: #dcedc8; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-cinza-claro2 { color: #f5f5f5; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-preto-claro2 { color: #757575; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-roxo-claro2 { color: #e1bee7; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-rosa-claro2 { color: #fce4ec; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-vermelho-claro2 { color: #ffcdd2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-laranja-claro2 { color: #ffe0b2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-amarelo-claro2 { color: #fff9c4; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-azul-claro3 { color: #b3e5fc; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-verde-claro3 { color: #dcedc8; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-cinza-claro3 { color: #f5f5f5; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-preto-claro3 { color: #757575; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-roxo-claro3 { color: #e1bee7; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-rosa-claro3 { color: #fce4ec; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-vermelho-claro3 { color: #ffcdd2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-laranja-claro3 { color: #ffe0b2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-amarelo-claro3 { color: #fff9c4; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-azul-claro4 { color: #b3e5fc; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-verde-claro4 { color: #dcedc8; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-cinza-claro4 { color: #f5f5f5; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-preto-claro4 { color: #757575; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-roxo-claro4 { color: #e1bee7; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-rosa-claro4 { color: #fce4ec; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-vermelho-claro4 { color: #ffcdd2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-laranja-claro4 { color: #ffe0b2; font-size: 1.1em; font-weight: bold; }
        .retangulo-valor-porcento-amarelo-claro4 { color: #fff9c4; font-size: 1.1em; font-weight: bold; }
        #custom-navbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            background: linear-gradient(90deg, #e0ffe0 0%, #baffba 100%);
            box-shadow: 0 2px 8px #0002;
            border-radius: 0 0 16px 16px;
            padding: 6px 8px;
            margin-bottom: 18px;
            border: none;
        }
        .nav-btn {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 1em;
            padding: 10px 0;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, font-weight 0.2s;
            color: #2d5c2f;
            border-bottom: 3px solid transparent;
            border-radius: 0 0 12px 12px;
            margin: 0 4px;
        }
        .nav-btn:focus,
        .nav-btn:active,
        .nav-btn:hover,
        .nav-btn.active {
            background: #baffba;
            color: #007a00;
            font-weight: bold;
            border-bottom: 3px solid #007a00;
            outline: none;
        }
        table { font-size: 0.88rem; }
        th, td { padding: 0.3em 0.5em !important; }
        .form-control.input-sm, .form-control.input-md, .form-control.input-lg, .form-control.input-xs {
            min-height: 28px;
            font-size: 0.92em;
            padding: 2px 6px;
        }
    </style>
</head>
<body>
    <div style="width:100%;display:flex;justify-content:flex-start;margin-top:4px;margin-bottom:12px; background: #fff;gap:0;flex-wrap:wrap;position:sticky;top:0;z-index:1001;box-shadow:0 2px 8px #0002;">
        <img src="logo-superendividamento.png" alt="SUPERENDIVIDAMENTO" style="max-width:20%; min-width:5%; height:70px; display:block; box-shadow: 0 2px 8px #0001; border-radius: 12px; margin-left:4px; margin-right:0;" />
        <div style="flex:1;justify-content:flex-start; width: 80%; padding-top: 5px; padding-bottom: 5px;">
            <div id="custom-navbar" style="height: 60px; position:static;box-shadow:none;margin-bottom:0;background:linear-gradient(90deg, #e0ffe0 0%, #baffba 100%);border-radius:16px;padding:6px 8px; margin-left:2; margin-right:4px;">
                <button onclick="window.location.href='index.html'" class="nav-btn" id="btn-dados">Dados Socioecon√¥micos</button>
                <button onclick="window.location.href='geral.html'" class="nav-btn" id="btn-geral">Geral</button>
                <button onclick="window.location.href='plano-de-pagamento.html'" class="nav-btn" id="btn-plano">Plano de Pagamento</button>
                <button onclick="window.location.href='panorama.html'" class="nav-btn" id="btn-panorama">Panorama</button>
            </div>
        </div>
    </div>
    <div class="container"; style="background: #ffffff00;">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:30px;">
            <div class="panorama-title">PANORAMA MENSAL RESUMIDO</div>
        </div>
        <!-- Ret√¢ngulo 1: Total Rendimentos Mensais L√≠quidos -->
        <div class="retangulo">
            <div class="retangulo-icone retangulo-icone-dinheiro">üí∞</div>
            <div class="retangulo-titulo">TOTAL RENDIMENTOS MENSAIS L√çQUIDOS AP√ìS DESPESAS EXISTENCIAIS</div>
            <div class="retangulo-valor" id="valor-rendimentos">R$ 0,00</div>
            <div class="retangulo-autos">Autos: <span id="valor-autos">-</span></div>
        </div>
        <!-- Ret√¢ngulo 2: Consignadas -->
        <div class="retangulo">
            <div class="retangulo-icone retangulo-icone-folha">üßæ</div>
            <div class="retangulo-titulo">SOMA DAS PARCELA(S) CONSIGNADA(S) EM FOLHA:</div>
            <div class="retangulo-valor-neg" id="valor-consignadas">-R$ 0,00</div>
            <div class="retangulo-valor-porcento" id="pct-consignadas">0,00%</div>
        </div>
        <!-- Ret√¢ngulo 3: N√£o Consignadas -->
        <div class="retangulo">
            <div class="retangulo-icone retangulo-icone-cartao">üí≥</div>
            <div class="retangulo-titulo">SOMA DAS PARCELAS N√ÉO CONSIGNADAS EM FOLHA:</div>
            <div class="retangulo-valor-neg" id="valor-nao-consignadas">-R$ 0,00</div>
            <div class="retangulo-valor-porcento" id="pct-nao-consignadas">0,00%</div>
        </div>
        <!-- Ret√¢ngulo 4: Comprometido -->
        <div class="retangulo">
            <div class="retangulo-icone retangulo-icone-comprometido">üéØ</div>
            <div class="retangulo-titulo">COMPROMETIDO:</div>
            <div class="retangulo-valor-porcento" id="pct-comprometido">0,00% : RENDA COMPROMETIDA EM PARCELAS</div>
            <div class="retangulo-label"><span id="valor-livre-mensal">R$ 0,00</span> : LIVRE MENSAL</div>
        </div>
        <!-- Ret√¢ngulo 5: Outras D√≠vidas -->
        <div class="retangulo">
            <div class="retangulo-icone retangulo-icone-outros">üìã</div>
            <div class="retangulo-titulo">SOMA DAS OUTRAS D√çVIDAS SEM PARCELAS MENSAIS ATUAIS:</div>
            <div class="retangulo-label">- <span id="valor-sem-parcelas">R$ 0,00</span> : TOTAL DAS D√çVIDAS SEM PARCELAS HOJE</div>
            <div class="retangulo-label"><span id="valor-parcelamento-60">R$ 0,00</span> : PARCELAMENTO DESSAS D√çVIDAS EM 60 MESES</div>
            <div class="retangulo-label">- <span id="valor-total-parcelas">R$ 0,00</span> : PARCELA MENSAL DE TODAS AS D√çVIDAS SOMADAS</div>
            <div class="retangulo-label"><span id="valor-livre-mensal-consolidado">R$ 0,00</span> : LIVRE MENSAL CONSOLIDADO</div>
            <div class="retangulo-valor-porcento" id="pct-comprometido-total">0,00% : RENDA COMPROMETIDA COM TODA D√çVIDA</div>
        </div>
        <!-- Ret√¢ngulo 6: Emergencial -->
        <div class="retangulo retangulo-verde">
            <div class="retangulo-icone retangulo-icone-alarme">üö®</div>
            <div class="retangulo-titulo">EMERGENCIAL AT√â FASE DE MEDIA√á√ÉO E/OU INSTRU√á√ÉO:</div>
            <div class="retangulo-pct-limite" id="pct-limite">0%</div>
            <div class="retangulo-label"><span id="valor-renda-sem-consignados">R$ 0,00</span> : RENDA SEM OS D√âBITOS CONSIGNADOS</div>
            <div class="retangulo-label"><span id="valor-consignacao-emergencial">R$ 0,00</span> : CONSIGNA√á√ÉO EMERGENCIAL</div>
            <div class="retangulo-label"><span id="valor-livre-emergencial">R$ 0,00</span> : LIVRE PARA OUTRAS DESPESAS (EXISTENCIAIS E FORA DO PLANO)</div>
        </div>
        <div class="retangulo-obs">
            <b>Para preenchimento deste formul√°rio:</b><br>
            1. Digitar percentual proposto de limite a comprometer e n√∫mero dos autos. As demais c√©lulas est√£o bloqueadas.<br>
            2. Na aba "rendimentos" cada linha √© uma fonte de pagamento de um m√™s normal/t√≠pico (INSS, Empregadores, previd√™ncia complementar, se recebe alugu√©is de algum im√≥vel ou outro tipo de rendimento)<br>
            3. Na aba "panorama mensal_consig" preencher nome de credor e valor de cada lan√ßamento a ser somado<br>
            4. Na aba "panorama mensal_n√£o_consig" preencher nome de credor e de cada parcela da d√≠vida n√£o consignada<br>
            5. Na aba "d√≠vidas sem parcelas mensais" aquelas d√≠vidas com parcela √∫nica, saldo de cheque especial, cart√£o e outros contratos com parcelas mensais, mas que precisam entrar na renegocia√ß√£o<br>
            6. Aten√ß√£o, aqui n√£o s√£o alimentados dados sobre as despesas existenciais, apenas dados de d√≠vidas<br>
            7. Este documento √© parte do atendimento do setor de Cidadania, da Rede Tem√°tica Superendividamento do Poder Judici√°rio Catarinense (CEJ). N√£o faz ju√≠zos de valor, apenas procura aparilhar visualmente as contas do processo para o caso. Parte de informa√ß√µes indicadas pelos autos, podendo ser atualizado pelas partes e demais interessados, inclusive para fins de media√ß√£o e instru√ß√£o.<br>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Fun√ß√£o para formatar valores em BRL
    function formatBRL(value) {
        if (isNaN(value)) return 'R$ 0,00';
        return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function getValorTotalParcelas() {
        // Buscar o valor total das parcelas do plano de pagamento (soma de todas as parcelas de um m√™s)
        let valorTotalParcelaPlano = 0;
        
        // Tentar buscar do localStorage
        const totalParcelaStr = localStorage.getItem('plano-valor-total-parcela');
        if (totalParcelaStr) {
            const valor = parseFloat(totalParcelaStr);
            if (!isNaN(valor)) {
                valorTotalParcelaPlano = valor;
            }
        }
        
        return valorTotalParcelaPlano;
    }

    function getValueFromLocalStorage(key, fallback=0) {
        const v = localStorage.getItem(key);
        return v ? parseFloat(v) : fallback;
    }
    function limparCampos() {
        document.querySelectorAll('input[type="text"], input[type="number"]').forEach(function(input) {
            input.value = '';
            if (input.id) localStorage.removeItem(input.id);
        });
        // Atualizar campos visuais se necess√°rio
        location.reload();
    }
    function atualizarPanorama() {
        // 1. Buscar valor final de dados-socioeconomicos.html (ap√≥s despesas existenciais)
        let valorRendimentos = getValueFromLocalStorage('valor-final', 0);
        document.getElementById('valor-rendimentos').textContent = formatBRL(valorRendimentos);

        // 2. Buscar n√∫mero dos autos da p√°gina geral.html
        document.getElementById('valor-autos').textContent = localStorage.getItem('numero-processo') || '-';

        // 3. Calcular soma das parcelas consignadas
        let valorConsignadas = 0;
        const linhasConsignados = JSON.parse(localStorage.getItem('linhas-consignados') || '[]');
        linhasConsignados.forEach(linha => {
            const parcelaMensal = parseFloat(linha.parcelaMensal?.replace(/\./g, '').replace(',', '.')) || 0;
            valorConsignadas += parcelaMensal;
        });

        // Atualizar valor e porcentagem das consignadas
        document.getElementById('valor-consignadas').textContent = '-' + formatBRL(valorConsignadas);
        const pctConsignadas = valorRendimentos > 0 ? (valorConsignadas / valorRendimentos) * 100 : 0;
        document.getElementById('pct-consignadas').textContent = pctConsignadas.toFixed(2) + '%';

        // 4. Calcular soma das parcelas n√£o consignadas
        let valorNaoConsignadas = 0;
        const linhasNaoConsignados = JSON.parse(localStorage.getItem('linhas-nao-consignados') || '[]');
        linhasNaoConsignados.forEach(linha => {
            const parcelaMensal = parseFloat(linha.parcelaMensal?.replace(/\./g, '').replace(',', '.')) || 0;
            valorNaoConsignadas += parcelaMensal;
        });
        // Atualizar valor e porcentagem das n√£o consignadas
        document.getElementById('valor-nao-consignadas').textContent = '-' + formatBRL(valorNaoConsignadas);
        const pctNaoConsignadas = valorRendimentos > 0 ? (valorNaoConsignadas / valorRendimentos) * 100 : 0;
        document.getElementById('pct-nao-consignadas').textContent = pctNaoConsignadas.toFixed(2) + '%';

        // 5. Comprometido
        let pctComprometida = getValueFromLocalStorage('plano-pct-limite', 0);
        let margem = valorRendimentos * (pctComprometida / 100);
        let valorLivreMensal = valorRendimentos - (valorConsignadas + valorNaoConsignadas);
        
        document.getElementById('valor-livre-mensal').textContent = formatBRL(valorLivreMensal);
        const pctComprometidoTotal = valorRendimentos > 0 ? ((valorConsignadas + valorNaoConsignadas) / valorRendimentos) * 100 : 0;
        document.getElementById('pct-comprometido').textContent = `${pctComprometidoTotal.toFixed(2)}% : RENDA COMPROMETIDA EM PARCELAS`;

        // 6. Outras D√≠vidas
        let valorSemParcelas = 0;
        for (let i = 1; i <= 1; i++) {
            const saldoDevedor = localStorage.getItem(`sem-parcela-${i}-saldo-devedor`);
            if (saldoDevedor) {
                const valor = parseFloat(saldoDevedor.replace(/\./g, '').replace(',', '.'));
                if (!isNaN(valor)) valorSemParcelas += valor;
            }
        }

        let valorParcelamento60 = valorSemParcelas / 60;
        let valorTotalParcelas = valorConsignadas + valorNaoConsignadas;
        let valorLivreMensalConsolidado = valorRendimentos - valorTotalParcelas;
        let pctComprometidoTotal2 = valorRendimentos > 0 ? (valorTotalParcelas / valorRendimentos) * 100 : 0;

        document.getElementById('valor-sem-parcelas').textContent = formatBRL(valorSemParcelas);
        document.getElementById('valor-parcelamento-60').textContent = formatBRL(valorParcelamento60);
        document.getElementById('valor-total-parcelas').textContent = '-' + formatBRL(valorTotalParcelas);
        document.getElementById('valor-livre-mensal-consolidado').textContent = formatBRL(valorLivreMensalConsolidado);
        document.getElementById('pct-comprometido-total').textContent = pctComprometidoTotal2.toFixed(2) + '% : RENDA COMPROMETIDA COM TODA D√çVIDA';

        // 7. Emergencial
        let pctLimite = getValueFromLocalStorage('plano-pct-limite', 30); // Default para 30%
        let valorRendaSemConsignados = valorRendimentos;
        let valorConsignacaoEmergencial = -(pctLimite / 100) * valorRendaSemConsignados;
        let valorLivreEmergencial = valorRendaSemConsignados + valorConsignacaoEmergencial;

        document.getElementById('pct-limite').textContent = pctLimite + '%';
        document.getElementById('valor-renda-sem-consignados').textContent = formatBRL(valorRendaSemConsignados);
        document.getElementById('valor-consignacao-emergencial').textContent = formatBRL(valorConsignacaoEmergencial);
        document.getElementById('valor-livre-emergencial').textContent = formatBRL(valorLivreEmergencial);
    }
    window.onload = atualizarPanorama;

    // Atualizar quando houver mudan√ßas no localStorage
    window.addEventListener('storage', function(e) {
        if (e.key === 'valor-final' || e.key === 'plano-pct-limite' || e.key === 'plano-qtde-parcelas') {
            atualizarPanorama();
        }
    });

    // Ativa o bot√£o da p√°gina atual
    const page = window.location.pathname.split('/').pop();
    if(page.includes('dados-socioeconomicos')) document.getElementById('btn-dados').classList.add('active');
    if(page.includes('geral')) document.getElementById('btn-geral').classList.add('active');
    if(page.includes('plano-de-pagamento')) document.getElementById('btn-plano').classList.add('active');
    if(page.includes('panorama')) document.getElementById('btn-panorama').classList.add('active');
    </script>
</body>
</html> 