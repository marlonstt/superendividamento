<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano de Pagamento - Superendividamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f4f4f4; }
        .container { max-width: 1400px; margin: 30px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
        h1 { color: #2d5c2f; margin-bottom: 30px; }
        table { font-size: 0.88rem; }
        th, td { padding: 0.3em 0.5em !important; vertical-align: middle !important; }
        .table-bordered th, .table-bordered td { border: 1px solid #333 !important; }
        .total-row { font-weight: bold; background: #f0f0f0; }
        .subtotal-row { font-weight: bold; background: #e0e0e0; }
        .input-sm { max-width: 80px; }
        .input-xs { max-width: 60px; }
        .input-md { max-width: 120px; }
        .input-lg { max-width: 180px; }
        .bg-light-green { background: #eaffea; }
        .bg-light-blue { background: #eaf4ff; }
        .bg-light-yellow { background: #fffbe6; }
        .text-green { color: #007a00; }
        .text-blue { color: #0057b7; }
        .text-red { color: #d00; }
        .scroll-x { overflow-x: auto; }
        @media (max-width: 900px) {
            .row { flex-direction: column; }
            .container { padding: 10px; }
        }
        #custom-navbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            background: linear-gradient(90deg, #e0ffe0 0%, #baffba 100%);
            box-shadow: 0 2px 8px #0002;
            border-radius: 0 0 16px 16px;
            padding: 6px 8px;
            margin-bottom: 18px;
            border: none;
        }
        .nav-btn {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 1em;
            padding: 10px 0;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, font-weight 0.2s;
            color: #2d5c2f;
            border-bottom: 3px solid transparent;
            border-radius: 0 0 12px 12px;
            margin: 0 4px;
        }
        .nav-btn:focus,
        .nav-btn:active,
        .nav-btn:hover,
        .nav-btn.active {
            background: #baffba;
            color: #007a00;
            font-weight: bold;
            border-bottom: 3px solid #007a00;
            outline: none;
        }
        @media print {
            #custom-navbar, .btn, .mb-3, .form-check, .form-switch {
                display: none !important;
            }
            body, .container {
                background: #fff !important;
                color: #000 !important;
                box-shadow: none !important;
            }
            table {
                page-break-inside: avoid;
            }
            th, td {
                color: #000 !important;
                background: #fff !important;
                border-color: #333 !important;
            }
            input, select, textarea {
                border: none !important;
                background: transparent !important;
                color: #000 !important;
                box-shadow: none !important;
                outline: none !important;
                pointer-events: none !important;
                appearance: none !important;
                -webkit-appearance: none !important;
                font-size: inherit !important;
                padding: 0 !important;
                margin: 0 !important;
                width: auto !important;
                min-width: 0 !important;
                max-width: 100% !important;
                height: auto !important;
            }
            input[type="number"], input[type="text"] {
                text-align: left !important;
            }
            #dados-impressao { display: block !important; }
        }
        @page { size: A4 landscape; }
        .form-control.input-sm, .form-control.input-md, .form-control.input-lg, .form-control.input-xs {
            min-height: 28px;
            font-size: 0.92em;
            padding: 2px 6px;
        }
    </style>
</head>
<body>
<div id="custom-navbar">
  <button type="button" onclick="window.location.href='dados-socioeconomicos.html'" class="nav-btn" id="btn-dados">Dados Socioeconômicos</button>
  <button type="button" onclick="window.location.href='geral.html'" class="nav-btn" id="btn-geral">Geral</button>
  <button type="button" onclick="window.location.href='plano-de-pagamento.html'" class="nav-btn" id="btn-plano">Plano de Pagamento</button>
  <button type="button" onclick="window.location.href='panorama.html'" class="nav-btn" id="btn-panorama">Panorama</button>
</div>
<div class="container">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:30px;">
        <h1>Plano de Pagamento</h1>
        <div style="display:flex; gap:10px;">
            <button type="button" class="btn btn-success mb-3" style="background:#baffba; color:#2d5c2f; border:none; font-weight:bold;" onclick="window.print()">Imprimir</button>
            <button type="button" class="btn btn-warning mb-3" style="background:#baffba; color:#2d5c2f; border:none; font-weight:bold;" onclick="limparCampos()">Limpar</button>
        </div>
    </div>
    <div id="dados-impressao" style="display:none; margin-bottom: 18px;">
      <div style="font-size:1.15em; font-weight:bold;">Consumidor: <span id="impressao-nome-consumidor"></span></div>
      <div style="font-size:1.15em; font-weight:bold;">Processo n.º: <span id="impressao-numero-processo"></span></div>
    </div>
    <!-- Tabela de Parâmetros do Plano -->
    <form id="planoForm">
        <div class="row mb-4">
            <div class="col-lg-8">
                <table class="table table-bordered mb-0">
                    <tr>
                        <th>% Comprometida</th>
                        <th>Margem</th>
                        <th>Meses para quitar</th>
                        <th>Qtde. de Parcelas</th>
                    </tr>
                    <tr>
                        <td><input type="number" step="0.1" min="0" max="100" id="comprometida" class="form-control input-sm" value="30"></td>
                        <td><input type="text" id="margem" class="form-control input-md bg-light-green" readonly></td>
                        <td><input type="number" step="1" min="2" max="60" id="mesesQuitar" class="form-control input-sm" value="2"></td>
                        <td style="display:flex; align-items:center; gap:8px;">
                            <input type="number" step="1" min="2" max="60" id="qtdeParcelas" class="form-control input-sm" value="2">
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <div style="display:flex; flex-direction:column; align-items:flex-start; margin-top:8px;">
                                <label for="condicaoEspecial" style="font-weight:bold;">Condição especial de parcelamento? (Até 120x)</label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="condicaoEspecial" style="width: 48px; height: 24px;">
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-4 d-flex align-items-center">
                <div class="ms-3">
                    <label for="receitaTotal" class="form-label mb-0">Receita mensal após despesas (R$):</label>
                    <span id="receitaTotal" class="form-control input-md" style="background:#e9ecef;display:block;min-height:38px;"></span>
                </div>
            </div>
                    </div>
        <!-- Tabela de Distribuição das Dívidas -->
        <div class="row mb-4">
            <div class="col-12 scroll-x">
                <table class="table table-bordered mb-0" id="tabela-dividas">
                    <thead class="table-light">
                        <tr>
                            <th>Credor</th>
                            <th>Informação</th>
                            <th>Saldo Devedor</th>
                            <th>% Dívida</th>
                            <th>Valor da Parcela</th>
                            <th>Parcela Residual</th>
                            <th>Valor total pago</th>
                            <th>% do saldo pago</th>
                        </tr>
                    </thead>
                    <tbody id="dividas-body">
                        <!-- Linhas geradas por JS -->
                    </tbody>
                    <tfoot>
                        <tr class="subtotal-row">
                            <td colspan="2">Total/Subtotal</td>
                            <td id="total-saldo-devedor">R$ 0,00</td>
                            <td id="total-pct-divida">100%</td>
                            <td id="total-valor-parcela">R$ 0,00</td>
                            <td></td>
                            <td id="total-valor-pago">R$ 0,00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
                    </div>
                </div>
        <!-- Tabela de Plano de Pagamento Proposto -->
        <div class="row mb-4">
            <div class="col-12 scroll-x">
                <table class="table table-bordered mb-0" id="tabela-parcelas">
                    <thead class="table-light" id="parcelas-head">
                        <!-- Cabeçalho gerado por JS -->
                    </thead>
                    <tbody id="parcelas-body">
                        <!-- Linhas geradas por JS -->
                    </tbody>
                    <tfoot id="parcelas-foot">
                        <!-- Rodapé gerado por JS -->
                    </tfoot>
                </table>
            </div>
        </div>
    </form>
    </div>
<script>
const bancos = [
    'Itaú', 'Bradesco', 'BMG RMG', 'Agibank', 'Banco do Brasil', 'Santander', 'Mercantil do Brasil', 'Sicob'
];
const infoPadrao = [
    'Dívida 1', 'Dívida 2', 'Dívida 3', 'Dívida 4', 'Dívida 5', 'Dívida 6', 'Dívida 7', 'Dívida 8'
];
const numDividas = 8;

function formatBRL(value) {
    return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

function renderDividasTable() {
    const tbody = document.getElementById('dividas-body');
    tbody.innerHTML = '';
    for (let i = 0; i < numDividas; i++) {
        tbody.innerHTML += `
        <tr>
            <td><span class="credor-text" style="display: inline-block; width: 100%; padding: 0.375rem 0.75rem;"></span></td>
            <td><input type="text" class="form-control info-input" value="${infoPadrao[i]}"></td>
            <td><input type="number" step="0.01" min="0" class="form-control saldo-input" value="0"></td>
            <td class="pct-divida">0%</td>
            <td class="valor-parcela">R$ 0,00</td>
            <td class="parcela-residual">R$ 0,00</td>
            <td class="valor-pago">R$ 0,00</td>
            <td class="pct-saldo-pago">-</td>
        </tr>`;
    }
}

function calcularDividas() {
    const receitaTotal = parseFloat(
      (document.getElementById('receitaTotal').textContent || '0')
        .replace(/[^\d,]/g, '')
        .replace(/\./g, '')
        .replace(',', '.')
    ) || 0;
    const pctComprometidaInput = parseFloat(document.getElementById('comprometida').value) || 0;
    const pctComprometida = pctComprometidaInput / 100;
    const margem = receitaTotal * pctComprometida;
    document.getElementById('margem').value = formatBRL(margem);
    const mesesQuitarInput = document.getElementById('mesesQuitar');
    const qtdeParcelasInput = document.getElementById('qtdeParcelas');
    const condicaoEspecial = document.getElementById('condicaoEspecial').checked;
    const maxParcelas = condicaoEspecial ? 120 : 60;
    let mesesQuitar = parseInt(mesesQuitarInput.value) || 2;
    let qtdeParcelas = parseInt(qtdeParcelasInput.value) || 2;
    if (qtdeParcelas < 2) qtdeParcelas = 2;
    if (qtdeParcelas > maxParcelas) qtdeParcelas = maxParcelas;
    if (mesesQuitar < 2) mesesQuitar = 2;
    if (mesesQuitar > maxParcelas) mesesQuitar = maxParcelas;
    // Saldo devedor
    let totalSaldoDevedor = 0;
    const saldoInputs = document.querySelectorAll('.saldo-input');
    saldoInputs.forEach(input => {
        totalSaldoDevedor += parseFloat(input.value) || 0;
    });
    document.getElementById('total-saldo-devedor').textContent = formatBRL(totalSaldoDevedor);
    // Cálculo do valor mínimo de parcelas para caber na margem
    let minParcelas = 2;
    if (margem > 0) {
        minParcelas = Math.ceil(totalSaldoDevedor / margem);
        if (minParcelas < 2) minParcelas = 2;
        if (minParcelas > maxParcelas) minParcelas = maxParcelas;
    }
    // Se a quantidade de parcelas for menor que o mínimo, ajustar e alertar
    let alertMsg = '';
    if (qtdeParcelas < minParcelas) {
        qtdeParcelas = minParcelas;
        mesesQuitar = minParcelas;
        qtdeParcelasInput.value = minParcelas;
        mesesQuitarInput.value = minParcelas;
        alertMsg = `O número de parcelas foi ajustado para ${minParcelas} para que a parcela mensal caiba na margem disponível.`;
    }
    // Se nem mesmo o máximo permitido for suficiente
    if ((totalSaldoDevedor / maxParcelas) > margem) {
        alertMsg = `Não é possível pagar o valor total das dívidas (${formatBRL(totalSaldoDevedor)}) com a margem disponível (${formatBRL(margem)}) mesmo em ${maxParcelas}x. Reduza o valor das dívidas ou aumente a margem.`;
    }
    // Valor total mensal das parcelas = totalSaldoDevedor / qtdeParcelas (garante que soma das parcelas = total das dívidas)
    const valorParcelaTotal = qtdeParcelas > 0 ? totalSaldoDevedor / qtdeParcelas : 0;
    let totalValorParcela = 0;
    saldoInputs.forEach((input, i) => {
        const saldo = parseFloat(input.value) || 0;
        const pctDivida = totalSaldoDevedor > 0 ? saldo / totalSaldoDevedor : 0;
        const valorParcela = pctDivida * valorParcelaTotal;
        let parcelaResidual = 0;
        if (qtdeParcelas <= 60) {
            parcelaResidual = (mesesQuitar - qtdeParcelas) * valorParcela;
        }
        document.querySelectorAll('.pct-divida')[i].textContent = (pctDivida*100).toFixed(2) + '%';
        document.querySelectorAll('.valor-parcela')[i].textContent = formatBRL(valorParcela);
        document.querySelectorAll('.parcela-residual')[i].textContent = formatBRL(parcelaResidual);
        totalValorParcela += valorParcela;
    });
    document.getElementById('total-pct-divida').textContent = '100%';
    document.getElementById('total-valor-parcela').textContent = formatBRL(totalValorParcela);
    renderParcelasTable(qtdeParcelas, receitaTotal, pctComprometida, margem, totalSaldoDevedor, valorParcelaTotal);
    // Exibir alerta se necessário
    const alertaDiv = document.getElementById('alerta-margem') || (() => {
        const d = document.createElement('div');
        d.id = 'alerta-margem';
        d.style.margin = '16px 0';
        d.style.fontWeight = 'bold';
        d.style.color = '#d00';
        d.style.fontSize = '1.1em';
        document.querySelector('.container').insertBefore(d, document.querySelector('.container').children[1]);
        return d;
    })();
    alertaDiv.textContent = alertMsg;
    if (!alertMsg) alertaDiv.style.display = 'none'; else alertaDiv.style.display = '';
}

function renderParcelasTable(qtdeParcelas, receitaTotal, pctComprometida, margem, totalSaldoDevedor, valorParcelaTotal) {
    // Cabeçalho
    const head = document.getElementById('parcelas-head');
    const body = document.getElementById('parcelas-body');
    const foot = document.getElementById('parcelas-foot');
    head.innerHTML = '';
    body.innerHTML = '';
    foot.innerHTML = '';
    // Cada dívida é uma coluna
    const credorTexts = Array.from(document.querySelectorAll('.credor-text'));
    const saldoInputs = Array.from(document.querySelectorAll('.saldo-input'));
    // Monta cabeçalho: nome do banco + número da dívida apenas se repetido
    let ths = '<th>Mês</th>';
    const bancoCount = {};
    credorTexts.forEach((span, i) => {
        if (span.textContent) {
            const banco = span.textContent;
            bancoCount[banco] = (bancoCount[banco] || 0) + 1;
            if (bancoCount[banco] === 1) {
                ths += `<th>${banco}</th>`;
            } else {
                ths += `<th>${banco} #${bancoCount[banco]}</th>`;
            }
        }
    });
    ths += '<th>Total</th>';
    head.innerHTML = `<tr>${ths}</tr>`;
    // Linhas de parcelas
    if (qtdeParcelas > 0 && totalSaldoDevedor > 0) {
        for (let mes = 1; mes <= qtdeParcelas; mes++) {
            let tds = `<td>Mês ${mes}</td>`;
            let somaLinha = 0;
            credorTexts.forEach((span, i) => {
                if (span.textContent) {
                    const saldo = parseFloat(saldoInputs[i].value) || 0;
                    const pctDivida = totalSaldoDevedor > 0 ? saldo / totalSaldoDevedor : 0;
                    const valor = +(pctDivida * valorParcelaTotal).toFixed(2);
                    tds += `<td>${formatBRL(valor)}</td>`;
                    somaLinha += valor;
                }
            });
            somaLinha = +(somaLinha).toFixed(2);
            tds += `<td>Valor Mensal: ${formatBRL(somaLinha)}</td>`;
            body.innerHTML += `<tr>${tds}</tr>`;
        }
        // Rodapé (total por dívida)
        let tfs = '<td>Total</td>';
        credorTexts.forEach((span, i) => {
            if (span.textContent) {
                const saldo = parseFloat(saldoInputs[i].value) || 0;
                const pctDivida = totalSaldoDevedor > 0 ? saldo / totalSaldoDevedor : 0;
                const somaCol = +(pctDivida * valorParcelaTotal * qtdeParcelas).toFixed(2);
                tfs += `<td>${formatBRL(somaCol)}</td>`;
            }
        });
        // Total geral
        let totalGeral = 0;
        credorTexts.forEach((span, i) => {
            if (span.textContent) {
                const saldo = parseFloat(saldoInputs[i].value) || 0;
                const pctDivida = totalSaldoDevedor > 0 ? saldo / totalSaldoDevedor : 0;
                totalGeral += pctDivida * valorParcelaTotal * qtdeParcelas;
            }
        });
        totalGeral = +(totalGeral).toFixed(2);
        tfs += `<td>Total Empréstimos: ${formatBRL(totalGeral)}</td>`;
        foot.innerHTML = `<tr>${tfs}</tr>`;
    } else {
        // Se algum valor essencial estiver zerado, exibe tudo como R$ 0,00
        for (let mes = 1; mes <= qtdeParcelas; mes++) {
            let tds = `<td>Mês ${mes}</td>`;
            credorTexts.forEach((span) => {
                if (span.textContent) {
                    tds += `<td>R$ 0,00</td>`;
                }
            });
            tds += `<td>R$ 0,00</td>`;
            body.innerHTML += `<tr>${tds}</tr>`;
        }
        let tfs = '<td>Total</td>';
        credorTexts.forEach((span) => {
            if (span.textContent) {
                tfs += `<td>R$ 0,00</td>`;
            }
        });
        tfs += `<td>R$ 0,00</td>`;
        foot.innerHTML = `<tr>${tfs}</tr>`;
    }
}

// Eventos
renderDividasTable();
calcularDividas();
['receitaTotal','comprometida','mesesQuitar','qtdeParcelas'].forEach(id => {
    document.getElementById(id).addEventListener('input', calcularDividas);
});
document.getElementById('dividas-body').addEventListener('input', calcularDividas);
document.getElementById('dividas-body').addEventListener('change', calcularDividas);

// Ativa o botão da página atual
const page = window.location.pathname.split('/').pop();
if(page.includes('dados-socioeconomicos')) document.getElementById('btn-dados').classList.add('active');
if(page.includes('geral')) document.getElementById('btn-geral').classList.add('active');
if(page.includes('plano-de-pagamento')) document.getElementById('btn-plano').classList.add('active');
if(page.includes('panorama')) document.getElementById('btn-panorama').classList.add('active');

document.getElementById('comprometida').addEventListener('input', function() {
    localStorage.setItem('plano-pct-limite', this.value);
    calcularDividas();
});

['mesesQuitar','qtdeParcelas'].forEach(id => {
    document.getElementById(id).addEventListener('input', function(e) {
        const otherId = id === 'mesesQuitar' ? 'qtdeParcelas' : 'mesesQuitar';
        let maxVal = document.getElementById('condicaoEspecial').checked ? 120 : 60;
        let v = parseInt(this.value) || 2;
        if (v < 2) v = 2;
        if (v > maxVal) v = maxVal;
        this.value = v;
        document.getElementById(otherId).value = v;
        // Salva ambos os valores no localStorage
        localStorage.setItem('plano-mesesQuitar', v);
        localStorage.setItem('plano-qtdeParcelas', v);
        calcularDividas();
    });
});

// Atualiza o atributo max dos inputs quando o checkbox muda
const condicaoEspecial = document.getElementById('condicaoEspecial');
condicaoEspecial.addEventListener('change', function() {
    const maxVal = this.checked ? 120 : 60;
    document.getElementById('mesesQuitar').max = maxVal;
    document.getElementById('qtdeParcelas').max = maxVal;
    // Se o valor atual for maior que o novo máximo, ajusta
    ['mesesQuitar','qtdeParcelas'].forEach(id => {
        let v = parseInt(document.getElementById(id).value) || 2;
        if (v > maxVal) {
            document.getElementById(id).value = maxVal;
            localStorage.setItem('plano-' + id, maxVal);
        }
    });
    calcularDividas();
});

window.onload = function() {
  // Primeiro renderiza a tabela
  renderDividasTable();

  // Preenche dados da página geral
  const saldoInputs = document.querySelectorAll('.saldo-input');
  const infoInputs = document.querySelectorAll('.info-input');
  const credorTexts = document.querySelectorAll('.credor-text');

  // Função auxiliar para preencher dados de uma dívida
  function preencherDivida(prefix, index, offset = 0) {
    const credor = localStorage.getItem(`${prefix}-${index}-credores`);
    const saldo = localStorage.getItem(`${prefix}-${index}-saldo-devedor`);
    const contrato = localStorage.getItem(`${prefix}-${index}-contratos`);
    const valorPago = localStorage.getItem(`${prefix}-${index}-valor-pago`);
    const valorContratado = localStorage.getItem(`${prefix}-${index}-valor-contratado`);
    const idx = index - 1 + offset;
    if (credorTexts[idx]) {
      credorTexts[idx].textContent = credor || '';
    }
    if (saldoInputs[idx]) {
      saldoInputs[idx].value = (saldo !== null && saldo !== undefined && saldo !== '') ? saldo : '';
    }
    if (infoInputs[idx]) {
      infoInputs[idx].value = contrato || '';
    }
    // Valor total pago = valor pago digitado na página Geral (linha = linha)
    const valorPagoCell = document.querySelectorAll('.valor-pago')[idx];
    let valorPagoBruto = localStorage.getItem(`${prefix}-${index}-valor-pago`);
    let valorPagoFormatado = 'R$ 0,00';
    if (valorPagoBruto !== null && valorPagoBruto !== undefined && valorPagoBruto !== '' && !isNaN(valorPagoBruto)) {
      valorPagoFormatado = formatBRL(Number(valorPagoBruto));
    }
    if (valorPagoCell) {
      valorPagoCell.textContent = valorPagoFormatado;
    }
    // % do saldo pago = (valor pago / valor contratado) * 100
    const pctSaldoPagoCell = document.querySelectorAll('.pct-saldo-pago')[idx];
    const valorPagoNum = parseFloat(valorPago);
    const valorContratadoNum = parseFloat(valorContratado);
    if (pctSaldoPagoCell) {
      if (!isNaN(valorPagoNum) && valorPagoNum > 0 && !isNaN(valorContratadoNum) && valorContratadoNum > 0) {
        const pct = (valorPagoNum / valorContratadoNum) * 100;
        pctSaldoPagoCell.textContent = pct.toFixed(2) + '%';
      } else if (!isNaN(valorContratadoNum) && valorContratadoNum === 0 && !isNaN(valorPagoNum) && valorPagoNum > 0) {
        pctSaldoPagoCell.textContent = '100.00%';
      } else if (!isNaN(valorContratadoNum) && valorContratadoNum > 0 && (!valorPago || valorPago === '0')) {
        pctSaldoPagoCell.textContent = '0.00%';
      } else {
        pctSaldoPagoCell.textContent = '-';
      }
    }
  }

  // Preenche consignados
  for (let i = 1; i <= 5; i++) {
    preencherDivida('consignado', i);
  }
  // Preenche não consignados
  for (let i = 1; i <= 2; i++) {
    preencherDivida('nao-consignado', i, 5);
  }
  // Preenche sem parcelas
  for (let i = 1; i <= 1; i++) {
    preencherDivida('sem-parcela', i, 7);
  }
  // Preenche dívidas consolidadas
  for (let i = 1; i <= 2; i++) {
    preencherDivida('divida-consolidada', i, 8);
  }

  // Preenche receita total da página dados-socioeconomicos
  const receitaTotal = localStorage.getItem('valor-final');
  if (receitaTotal) {
    document.getElementById('receitaTotal').textContent = formatBRL(parseFloat(receitaTotal));
  } else {
    document.getElementById('receitaTotal').textContent = formatBRL(0);
  }

  // Calcula valores iniciais
  calcularDividas();

  // Restaurar mesesQuitar e qtdeParcelas do localStorage, se existirem
  const mesesQuitarSalvo = localStorage.getItem('plano-mesesQuitar');
  const qtdeParcelasSalvo = localStorage.getItem('plano-qtdeParcelas');
  if (mesesQuitarSalvo !== null) document.getElementById('mesesQuitar').value = mesesQuitarSalvo;
  if (qtdeParcelasSalvo !== null) document.getElementById('qtdeParcelas').value = qtdeParcelasSalvo;

  // Restaurar % Comprometida do localStorage, se existir
  const pctComprometidaSalvo = localStorage.getItem('plano-pct-limite');
  if (pctComprometidaSalvo !== null) document.getElementById('comprometida').value = pctComprometidaSalvo;

  // Recalcular tudo após restaurar os valores salvos
  calcularDividas();

  // Preencher dados do consumidor e processo para impressão
  document.getElementById('impressao-nome-consumidor').textContent = localStorage.getItem('nome-consumidor') || '';
  document.getElementById('impressao-numero-processo').textContent = localStorage.getItem('numero-processo') || '';
};
</script>
</body>
</html>